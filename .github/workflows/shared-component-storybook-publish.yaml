name: Publish shared component storybook
on:
    workflow_dispatch: {}
    push:
        branches:
            - "develop"
        paths:
            - "packages/shared-components/**/*"

permissions: {}

jobs:
    build:
        name: Build storybook
        uses: ./.github/workflows/shared-component-storybook-build.yml

    publish:
        name: Publish storybook
        runs-on: ubuntu-latest
        needs: build
        environment: SharedComponents
        steps:
            - uses: actions/download-artifact@37930b1c2abaa49bbe596cd826c3c89aef350131 # v7
              with:
                  name: shared-components-storybook
                  path: storybook-static

            - name: ðŸš€ Deploy to Cloudflare Pages
              uses: cloudflare/wrangler-action@9681c2997648301493e78cacbfb790a9f19c833f # v3
              with:
                  apiToken: ${{ secrets.CF_PAGES_TOKEN }}
                  accountId: ${{ secrets.CF_PAGES_ACCOUNT_ID }}
                  command: pages deploy storybook-static --project-name=shared-components-storybook
