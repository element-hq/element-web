name: Publish shared component documentation
on:
    workflow_dispatch: {}
    push:
        branches:
            - "develop"
        paths:
            - "packages/shared-components/**/*"

permissions: {}

jobs:
    doc:
        name: Publish Documentation
        runs-on: ubuntu-latest
        environment: SharedComponents
        steps:
            - name: ðŸ§® Checkout code
              uses: actions/checkout@8e8c483db84b4bee98b60c0593521ed34d9990e8 # v6

            - name: ðŸ”§ Yarn cache
              uses: actions/setup-node@395ad3262231945c25e8478fd5baf05154b1d79f # v6
              with:
                  cache: "yarn"
                  node-version-file: package.json

            - name: ðŸ”¨ Install dependencies
              working-directory: packages/shared-components
              run: "yarn install --pure-lockfile"

            - name: ðŸ“– Generate docs
              working-directory: packages/shared-components
              run: yarn build:docs

            - name: ðŸš€ Deploy to Cloudflare Pages
              uses: cloudflare/wrangler-action@9681c2997648301493e78cacbfb790a9f19c833f # v3
              with:
                  apiToken: ${{ secrets.CF_PAGES_TOKEN }}
                  accountId: ${{ secrets.CF_PAGES_ACCOUNT_ID }}
                  workingDirectory: "packages/shared-components"
                  command: pages deploy _docs --project-name=shared-components-docs
