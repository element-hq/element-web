(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{1167:function(e,t,n){"use strict";t.a=n.p+"i18n/languages.9ef552b.json"},1169:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return c}));var i=n(73),s=n.n(i);function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){s()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const r={bgColor:"#d00",textColor:"#fff",fontFamily:"sans-serif",fontWeight:"bold",isUp:!1,isLeft:!1};class c{constructor(e={}){s()(this,"browser",{ff:void 0!==window.InstallTrigger,opera:!!window.opera||navigator.userAgent.includes("Opera")}),s()(this,"params",void 0),s()(this,"canvas",void 0),s()(this,"baseImage",void 0),s()(this,"context",void 0),s()(this,"icons",void 0),s()(this,"isReady",!1),s()(this,"readyCb",()=>{}),this.params=o(o({},r),e),this.icons=c.getIcons(),this.canvas=document.createElement("canvas"),this.baseImage=document.createElement("img");const t=this.icons[this.icons.length-1];t.hasAttribute("href")?(this.baseImage.setAttribute("crossOrigin","anonymous"),this.baseImage.onload=()=>{this.canvas.height=this.baseImage.height>0?this.baseImage.height:32,this.canvas.width=this.baseImage.width>0?this.baseImage.width:32,this.context=this.canvas.getContext("2d"),this.ready()},this.baseImage.setAttribute("src",t.getAttribute("href"))):(this.canvas.height=this.baseImage.height=32,this.canvas.width=this.baseImage.width=32,this.context=this.canvas.getContext("2d"),this.ready())}reset(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.drawImage(this.baseImage,0,0,this.canvas.width,this.canvas.height)}options(e,t){const n={n:"number"==typeof e?Math.abs(e):e,len:(""+e).length,x:.4,y:.4,w:.6,h:.6};return t.isUp&&(n.y<.6?n.y=n.y-.4:n.y=n.y-2*n.y+(1-n.w)),t.isLeft&&(n.x<.6?n.x=n.x-.4:n.x=n.x-2*n.x+(1-n.h)),n.x=this.canvas.width*n.x,n.y=this.canvas.height*n.y,n.w=this.canvas.width*n.w,n.h=this.canvas.height*n.h,n}circle(e,t){const n=o(o({},this.params),t),i=this.options(e,n);let s=!1;2===i.len?(i.x=i.x-.4*i.w,i.w=1.4*i.w,s=!0):i.len>=3&&(i.x=i.x-.65*i.w,i.w=1.65*i.w,s=!0),this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.drawImage(this.baseImage,0,0,this.canvas.width,this.canvas.height),this.context.beginPath();const a=Math.floor(i.h*(i.n>99?.85:1))+"px";if(this.context.font=`${n.fontWeight} ${a} ${n.fontFamily}`,this.context.textAlign="center",s?(this.context.moveTo(i.x+i.w/2,i.y),this.context.lineTo(i.x+i.w-i.h/2,i.y),this.context.quadraticCurveTo(i.x+i.w,i.y,i.x+i.w,i.y+i.h/2),this.context.lineTo(i.x+i.w,i.y+i.h-i.h/2),this.context.quadraticCurveTo(i.x+i.w,i.y+i.h,i.x+i.w-i.h/2,i.y+i.h),this.context.lineTo(i.x+i.h/2,i.y+i.h),this.context.quadraticCurveTo(i.x,i.y+i.h,i.x,i.y+i.h-i.h/2),this.context.lineTo(i.x,i.y+i.h/2),this.context.quadraticCurveTo(i.x,i.y,i.x+i.h/2,i.y)):this.context.arc(i.x+i.w/2,i.y+i.h/2,i.h/2,0,2*Math.PI),this.context.fillStyle=n.bgColor,this.context.fill(),this.context.closePath(),this.context.beginPath(),this.context.stroke(),this.context.fillStyle=n.textColor,"number"==typeof i.n&&i.n>999){const e=(i.n>9999?9:Math.floor(i.n/1e3))+"k+";this.context.fillText(e,Math.floor(i.x+i.w/2),Math.floor(i.y+i.h-.2*i.h))}else this.context.fillText(""+i.n,Math.floor(i.x+i.w/2),Math.floor(i.y+i.h-.15*i.h));this.context.closePath()}ready(){this.isReady||(this.isReady=!0,this.readyCb())}setIcon(t){e(()=>{this.setIconSrc(t.toDataURL("image/png"))})}setIconSrc(e){if(this.browser.ff||this.browser.opera){const t=this.icons[this.icons.length-1],n=window.document.createElement("link");this.icons=[n],n.setAttribute("rel","icon"),n.setAttribute("type","image/png"),window.document.getElementsByTagName("head")[0].appendChild(n),n.setAttribute("href",e),t.parentNode&&t.parentNode.removeChild(t)}else this.icons.forEach(t=>{t.setAttribute("href",e)})}badge(e,t){this.isReady?("string"==typeof e||e>0?this.circle(e,t):this.reset(),this.setIcon(this.canvas)):this.readyCb=()=>{this.badge(e,t)}}static getLinks(){const e=[],t=window.document.getElementsByTagName("head")[0].getElementsByTagName("link");for(let n=0;n<t.length;n++)/(^|\s)icon(\s|$)/i.test(t[n].getAttribute("rel"))&&e.push(t[n]);return e}static getIcons(){let e=c.getLinks();return 0===e.length&&(e=[window.document.createElement("link")],e[0].setAttribute("rel","icon"),window.document.getElementsByTagName("head")[0].appendChild(e[0])),e.forEach(e=>{e.setAttribute("type","image/png")}),e}}}).call(this,n(304).setImmediate)},14:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var i=n(10),s=n.n(i);async function a(e=""){""===e||e.endsWith("/")||(e+="/");const t=o(`${e}config.${document.domain}.json`),n=o(e+"config.json");try{const e=await t;if(0===Object.keys(e).length)throw new Error;return e}catch(e){return await n}}function o(e){return new Promise((function(t,n){s()({method:"GET",url:e,qs:{cachebuster:Date.now()}},(e,i,s)=>{try{if(e||i.status<200||i.status>=300)return i&&(404==i.status||0==i.status&&""==s)&&t({}),void n({err:e,response:i});t(JSON.parse(s))}catch(e){n({err:e})}})}))}},32:function(e,t,n){"use strict";n.r(t),n.d(t,"rageshakePromise",(function(){return G})),n.d(t,"preparePlatform",(function(){return q})),n.d(t,"loadConfig",(function(){return $})),n.d(t,"loadOlm",(function(){return z})),n.d(t,"loadLanguage",(function(){return Q})),n.d(t,"loadSkin",(function(){return J})),n.d(t,"loadTheme",(function(){return Y})),n.d(t,"loadApp",(function(){return X})),n.d(t,"showError",(function(){return Z})),n.d(t,"showIncompatibleBrowser",(function(){return ee})),n.d(t,"_t",(function(){return te}));var i=n(477),s=n(478),a=n.n(s),o=n(64),r=n(33),c=n.n(r),l=n(34),d=n(40),h=n(73),u=n.n(h),p=n(1168),g=n(39),w=n(14),m=n(1169);const f={CHECKING:"CHECKING",ERROR:"ERROR",NOTAVAILABLE:"NOTAVAILABLE",DOWNLOADING:"DOWNLOADING",READY:"READY"};class y extends p.a{constructor(...e){super(...e),u()(this,"showUpdateCheck",!1),u()(this,"_favicon",void 0),u()(this,"startUpdateCheck",()=>{this.showUpdateCheck=!0,g.a.dispatch({action:"check_updates",value:{status:f.CHECKING}})}),u()(this,"stopUpdateCheck",()=>{this.showUpdateCheck=!1,g.a.dispatch({action:"check_updates",value:!1})})}async getConfig(){return Object(w.a)()}getHumanReadableName(){return"Vector Base Platform"}get favicon(){return this._favicon?this._favicon:this._favicon=new m.a}_updateFavicon(){let e="#d00",t=this.notificationCount;this.errorDidOccur&&(t=t||"×",e="#f00"),this.favicon.badge(t,{bgColor:e})}setNotificationCount(e){this.notificationCount!==e&&(super.setNotificationCount(e),this._updateFavicon())}setErrorStatus(e){this.errorDidOccur!==e&&(super.setErrorStatus(e),this._updateFavicon())}startUpdater(){}async canSelfUpdate(){return!1}getUpdateCheckStatusEnum(){return f}installUpdate(){}getDefaultDeviceDisplayName(){return Object(l.a)("Unknown device")}}var b=n(1170),v=n(320),C=n(41),x=n(464),I=n(162),E=n(298),A=n(48),O=n(8),k=n(51);const _=window.ipcRenderer,N=navigator.platform.toUpperCase().includes("MAC");function R(e){["call_state"].includes(e.action)&&_.send("app_onAction",e)}function T(e){return!0===e?{status:f.DOWNLOADING}:!1===e?{status:f.NOTAVAILABLE}:{status:f.ERROR,detail:e}}class S extends b.a{constructor(){super(),u()(this,"pendingIpcCalls",{}),u()(this,"nextIpcCallId",0),u()(this,"_onIpcReply",(e,t)=>{if(void 0===t.id)return void console.warn("Ignoring IPC reply with no ID");if(void 0===this.pendingIpcCalls[t.id])return void console.warn("Unknown IPC payload ID: "+t.id);const n=this.pendingIpcCalls[t.id];delete this.pendingIpcCalls[t.id],t.error?n.reject(t.error):n.resolve(t.reply)}),_.on("seshatReply",this._onIpcReply)}async _ipcCall(e,...t){const n=++this.nextIpcCallId;return new Promise((i,s)=>{this.pendingIpcCalls[n]={resolve:i,reject:s},window.ipcRenderer.send("seshat",{id:n,name:e,args:t})})}async supportsEventIndexing(){return this._ipcCall("supportsEventIndexing")}async initEventIndex(){return this._ipcCall("initEventIndex")}async addEventToIndex(e,t){return this._ipcCall("addEventToIndex",e,t)}async deleteEvent(e){return this._ipcCall("deleteEvent",e)}async isEventIndexEmpty(){return this._ipcCall("isEventIndexEmpty")}async commitLiveEvents(){return this._ipcCall("commitLiveEvents")}async searchEventIndex(e){return this._ipcCall("searchEventIndex",e)}async addHistoricEvents(e,t,n){return this._ipcCall("addHistoricEvents",e,t,n)}async addCrawlerCheckpoint(e){return this._ipcCall("addCrawlerCheckpoint",e)}async removeCrawlerCheckpoint(e){return this._ipcCall("removeCrawlerCheckpoint",e)}async loadFileEvents(e){return this._ipcCall("loadFileEvents",e)}async loadCheckpoints(){return this._ipcCall("loadCheckpoints")}async closeEventIndex(){return this._ipcCall("closeEventIndex")}async getStats(){return this._ipcCall("getStats")}async deleteEventIndex(){return this._ipcCall("deleteEventIndex")}}class U extends y{constructor(){super(),u()(this,"eventIndexManager",new S),u()(this,"pendingIpcCalls",{}),u()(this,"nextIpcCallId",0),u()(this,"ssoID",Object(O.a)(32)),u()(this,"startUpdateCheck",()=>{this.showUpdateCheck||(super.startUpdateCheck(),_.send("check_updates"))}),g.a.register(R),_.on("check_updates",(e,t)=>{this.showUpdateCheck&&(g.a.dispatch({action:"check_updates",value:T(t)}),this.showUpdateCheck=!1)}),_.on("before-quit",(function(){console.log("riot-desktop closing"),v.b()})),_.on("ipcReply",this._onIpcReply.bind(this)),_.on("update-downloaded",this.onUpdateDownloaded.bind(this)),_.on("preferences",()=>{g.a.fire(k.a.ViewUserSettings)}),N?(Object(E.c)(E.a.NAVIGATION,{keybinds:[{modifiers:[E.b.COMMAND],key:A.a.COMMA}],description:Object(l.b)("Open user settings")}),Object(E.c)(E.a.NAVIGATION,{keybinds:[{modifiers:[E.b.COMMAND],key:A.a.SQUARE_BRACKET_LEFT},{modifiers:[E.b.COMMAND],key:A.a.SQUARE_BRACKET_RIGHT}],description:Object(l.b)("Previous/next recently visited room or community")})):Object(E.c)(E.a.NAVIGATION,{keybinds:[{modifiers:[E.b.ALT],key:A.a.ARROW_LEFT},{modifiers:[E.b.ALT],key:A.a.ARROW_RIGHT}],description:Object(l.b)("Previous/next recently visited room or community")}),this._ipcCall("startSSOFlow",this.ssoID)}async getConfig(){return this._ipcCall("getConfig")}async onUpdateDownloaded(e,t){g.a.dispatch({action:"new_version",currentVersion:await this.getAppVersion(),newVersion:t,releaseNotes:t.releaseNotes})}getHumanReadableName(){return"Electron Platform"}setNotificationCount(e){this.notificationCount!==e&&(super.setNotificationCount(e),_.send("setBadgeCount",e))}supportsNotifications(){return!0}maySendNotifications(){return!0}displayNotification(e,t,n,i){navigator.userAgent.includes("Linux")&&(t=t.replace(/</g,"&lt;").replace(/>/g,"&gt;"));const s={body:t,silent:!0};n&&(s.icon=n);const a=new window.Notification(e,s);return a.onclick=()=>{g.a.dispatch({action:"view_room",room_id:i.roomId}),window.focus(),this._ipcCall("focusWindow")},a}loudNotification(e,t){_.send("loudNotification")}clearNotification(e){e.close()}async getAppVersion(){return this._ipcCall("getAppVersion")}supportsAutoLaunch(){return!0}async getAutoLaunchEnabled(){return this._ipcCall("getAutoLaunchEnabled")}async setAutoLaunchEnabled(e){return this._ipcCall("setAutoLaunchEnabled",e)}supportsAutoHideMenuBar(){return!N}async getAutoHideMenuBarEnabled(){return this._ipcCall("getAutoHideMenuBarEnabled")}async setAutoHideMenuBarEnabled(e){return this._ipcCall("setAutoHideMenuBarEnabled",e)}supportsMinimizeToTray(){return!N}async getMinimizeToTrayEnabled(){return this._ipcCall("getMinimizeToTrayEnabled")}async setMinimizeToTrayEnabled(e){return this._ipcCall("setMinimizeToTrayEnabled",e)}async canSelfUpdate(){const e=await this._ipcCall("getUpdateFeedUrl");return Boolean(e)}installUpdate(){_.send("install_update")}getDefaultDeviceDisplayName(){return Object(l.a)("Riot Desktop (%(platformName)s)",{platformName:navigator.userAgent.includes("Macintosh")?"macOS":navigator.userAgent.includes("FreeBSD")?"FreeBSD":navigator.userAgent.includes("OpenBSD")?"OpenBSD":navigator.userAgent.includes("SunOS")?"SunOS":navigator.userAgent.includes("Windows")?"Windows":navigator.userAgent.includes("Linux")?"Linux":"Unknown"})}screenCaptureErrorString(){return null}requestNotificationPermission(){return Promise.resolve("granted")}reload(){window.location.reload(!1)}async _ipcCall(e,...t){const n=++this.nextIpcCallId;return new Promise((i,s)=>{this.pendingIpcCalls[n]={resolve:i,reject:s},window.ipcRenderer.send("ipcCall",{id:n,name:e,args:t})})}_onIpcReply(e,t){if(void 0===t.id)return void console.warn("Ignoring IPC reply with no ID");if(void 0===this.pendingIpcCalls[t.id])return void console.warn("Unknown IPC payload ID: "+t.id);const n=this.pendingIpcCalls[t.id];delete this.pendingIpcCalls[t.id],t.error?n.reject(t.error):n.resolve(t.reply)}getEventIndexingManager(){return this.eventIndexManager}setLanguage(e){this._ipcCall("setLanguage",e).catch(e=>{console.log("Failed to send setLanguage IPC to Electron"),console.error(e)})}getSSOCallbackUrl(e,t,n){const i=super.getSSOCallbackUrl(e,t,n);return i.protocol="riot",i.searchParams.set("riot-desktop-ssoid",this.ssoID),i}startSingleSignOn(e,t,n){super.startSingleSignOn(e,t,n),C.a.createTrackedDialog("Electron","SSO",x.a,{title:Object(l.a)("Go to your browser to complete Sign In"),description:c.a.createElement(I.a,null)})}_navigateForwardBack(e){this._ipcCall(e?"navigateBack":"navigateForward")}onKeyDown(e){let t=!1;switch(e.key){case A.a.SQUARE_BRACKET_LEFT:case A.a.SQUARE_BRACKET_RIGHT:!N||!e.metaKey||e.altKey||e.ctrlKey||e.shiftKey||(this._navigateForwardBack(e.key===A.a.SQUARE_BRACKET_LEFT),t=!0);break;case A.a.ARROW_LEFT:case A.a.ARROW_RIGHT:N||!e.altKey||e.metaKey||e.ctrlKey||e.shiftKey||(this._navigateForwardBack(e.key===A.a.ARROW_LEFT),t=!0)}return t}}var D=n(10),L=n.n(D),P=n(56),B=n.n(P),j=n(1171),M=n.n(j);class F extends y{constructor(...e){super(...e),u()(this,"runningVersion",null),u()(this,"pollForUpdate",()=>this._getVersion().then(e=>{if(null===this.runningVersion)this.runningVersion=e;else if(this.runningVersion!==e)return void g.a.dispatch({action:"new_version",currentVersion:this.runningVersion,newVersion:e});return{status:f.NOTAVAILABLE}},e=>(console.error("Failed to poll for update",e),{status:f.ERROR,detail:e.message||e.status?e.status.toString():"Unknown Error"}))),u()(this,"startUpdateCheck",()=>{this.showUpdateCheck||(super.startUpdateCheck(),this.pollForUpdate().then(e=>{this.showUpdateCheck&&e&&g.a.dispatch({action:"check_updates",value:e})}))})}getHumanReadableName(){return"Web Platform"}supportsNotifications(){return Boolean(window.Notification)}maySendNotifications(){return"granted"===window.Notification.permission}requestNotificationPermission(){return new Promise((function(e,t){window.Notification.requestPermission(t=>{e(t)})}))}displayNotification(e,t,n,i){const s={body:t,tag:"vector",silent:!0};n&&(s.icon=n);const a=new window.Notification(e,s);a.onclick=function(){g.a.dispatch({action:"view_room",room_id:i.roomId}),window.focus(),a.close()}}_getVersion(){return new Promise((function(e,t){L()({method:"GET",url:"version",qs:{cachebuster:Date.now()}},(n,i,s)=>{if(n||i.status<200||i.status>=300)return null===n&&(n={status:i.status}),void t(n);const a=s.trim();e(a)})}))}getAppVersion(){return null!==this.runningVersion?Promise.resolve(this.runningVersion):this._getVersion()}startUpdater(){this.pollForUpdate(),setInterval(this.pollForUpdate,6e5)}async canSelfUpdate(){return!0}installUpdate(){window.location.reload(!0)}getDefaultDeviceDisplayName(){const e=B.a.parse(window.location.href);e.protocol="",e.search="",e.hash="",e.pathname=e.pathname.replace(/\/$/,"");let t=e.format();t=t.replace(/^\/\//,"");const n=new M.a,i=n.getBrowser().name||"unknown browser";let s=n.getOS().name||"unknown OS";return"Mac OS"===s&&(s="macOS"),Object(l.a)("%(appName)s (%(browserName)s, %(osName)s)",{appName:t,browserName:i,osName:s})}screenCaptureErrorString(){return"https:"!==window.location.protocol?Object(l.a)("You need to be using HTTPS to place a screen-sharing call."):null}reload(){window.location.reload(!1)}}var V=n(50),H=n(45),W=n(228),K=n(318);window.mxSendRageshake=function(e,t){void 0===t&&(t=!0),e&&e.trim()?Object(K.a)(H.a.get().bug_report_endpoint_url,{userText:e,sendLogs:t,progressCallback:console.log.bind(console)}).then(()=>{console.log("Bug report sent!")},e=>{console.error(e)}):console.error("Cannot send a rageshake without a message - please tell us what went wrong")};const G=function(){const e=v.d();return e.then(()=>{console.log("Initialised rageshake."),console.log("To fix line numbers in Chrome: Meatball menu → Settings → Blackboxing → Add /rageshake\\.js$"),window.addEventListener("beforeunload",e=>{console.log("riot-web closing"),v.b()}),v.a()},e=>{console.error("Failed to initialise rageshake: "+e)}),e}();function q(){if(window.ipcRenderer){console.log("Using Electron platform");const e=new U;V.a.set(e)}else console.log("Using Web platform"),V.a.set(new F)}async function $(){H.a.put(await V.a.get().getConfig()||{})}function z(){return a.a.init({locateFile:()=>i.a}).then(()=>{console.log("Using WebAssembly Olm")}).catch(e=>(console.log("Failed to load Olm: trying legacy version",e),new Promise((e,t)=>{const n=document.createElement("script");n.src="olm_legacy.js",n.onload=e,n.onerror=t,document.body.appendChild(n)}).then(()=>window.Olm.init()).then(()=>{console.log("Using legacy Olm")}).catch(e=>{console.log("Both WebAssembly and asm.js Olm failed!",e)})))}async function Q(){const e=d.b.getValue("language",null,!0);let t=[];e?t=[e]:l.f().forEach(e=>{t.push(...l.g(e))});try{await l.k(t),document.documentElement.setAttribute("lang",l.d())}catch(e){console.error("Unable to set language",e)}}async function J(){console.log("Loading skin...");const[e,t]=await Promise.all([Promise.resolve().then(n.bind(null,36)),n.e(11).then(n.bind(null,1197))]);e.loadSkin(t),console.log("Skin loaded!")}async function Y(){Object(W.d)()}async function X(e){const t=await n.e(10).then(n.bind(null,1187));window.matrixChat=o.render(await t.loadApp(e),document.getElementById("matrixchat"))}async function Z(e,t){const i=(await n.e(5).then(n.bind(null,1188))).default;window.matrixChat=o.render(r.createElement(i,{title:e,messages:t}),document.getElementById("matrixchat"))}async function ee(e){const t=(await n.e(4).then(n.bind(null,1189))).default;window.matrixChat=o.render(r.createElement(t,{onAccept:e}),document.getElementById("matrixchat"))}const te=l.a}}]);
//# sourceMappingURL=init.js.map